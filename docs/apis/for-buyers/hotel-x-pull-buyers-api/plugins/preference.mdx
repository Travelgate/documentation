---
sidebar_position: 5
---

# Preference

The **Preference Plugin** is a more advanced and configurable version of the [**Cheapest Price Plugin**](/docs/apis/for-buyers/hotel-x-pull-buyers-api/plugins/cheapest-price). While the Cheapest Price Plugin selects the lowest-priced option based on defined criteria, the Preference Plugin allows you to **prioritize certain options over others**, even if they are not the absolute cheapest.  

This is particularly useful when using **Hotel-X in multi mode**, where multiple suppliers may offer different prices for the same hotel, board, or room type. With the Preference Plugin, you can **set preference rules** that influence how results are ranked and selected.  

For example, you might want to:  
- Prioritize a specific supplier for certain hotels, even if their price is up to **X% higher**.  
- Give preference to a supplier during specific **dates or destinations**.  
- Customize selection rules based on **your business strategy**.  

By leveraging the **Preference Plugin**, you gain greater control over how options are selected, allowing you to fine-tune your results based on your own **supplier relationships, pricing strategy, and business goals**.  

## Preference Plugin Workflow

1. Starts getting all the args set by the client in the query, like options, parameters (primaryKey among others), client tokens, etc.

2. Gets the rules stored in database which will establish which options will be added or discarded based on several factors as % of tolerance of the price, hotel codes, supplier, etc.

3. Builds a group function which will help to clasify the options slice in '*n*' different groups based on the primary key established in the query by the client and the rules stored in the data base (SFTP preference file).Sorts the options in price order (from cheap to expensive).

4. Go over each option and group them by primary key index. However not all the options will be filled in these aggrupations. This is where the rules come into play.
To determine if an option will be discarded or not we have to check the group function which does the following: 
   * If it is the first option in the pk index, this option will be automatically added.
   * If the rule says that the competitors has to be discarded, all the options of that pk index will be discarded except for the first (the cheapest).
   * If it isn't the first option and there aren‚Äôt any rule that matches the option, this option will be discarded.
   * If it isn't the first option and the price is higher than the tolerance % established in the rules for that pk index, the option will also be discarded.

5. With the resulting options grouped by pk indexes, finally collects all of them and return them to the service process which has used the plugin.

### Example

**Preference Rule Loaded:** Tolerance Percentage = **1%** for all **SUP1** hotels and 'filterCompetitors' is enabled.  

**Scenario:**  
- **Supplier SUP1** offers **126‚Ç¨** for Hotel Santo Domingo (Double Room, All Inclusive).  
- **Supplier SUP2** offers **125‚Ç¨** for the same hotel and room type.  

By default, **SUP2 wins** because it has the lowest price.  
However, with the preference rule applied:  

1. We first group all options with the same **aggregation primary key** (Hotel Santo Domingo - Double Room - All Inclusive).  
2. Since there is a **preference rule for SUP1 hotels**, we apply the **tolerance check**:  

   **Formula:**  
   _Cheapest option price * (1 + tolerance%)_  
   `125‚Ç¨ * (1 + 1/100) = 125‚Ç¨ * 1.01 = 126.25‚Ç¨`  

3. Since **126.25‚Ç¨ is higher than 126‚Ç¨** and **'filterCompetitors' is enabled**, the **SUP2 option is discarded**, making **SUP1 the only winner**.  

If **'filterCompetitors' were disabled**, SUP1 would be added to the group, and **both options would be returned** in the results.



To get started with the Preference plugin, follow these simple steps:

## 1. Create and Upload your Preference File

To get started, create your preference file in the correct format and then upload it to your SFTP account. We've provided a template file below ‚¨áÔ∏è to help you with this process. Just click on the file name, add your own rules, save it in CSV format, and then upload it to the corresponding folder in your SFTP.

```mdx-code-block
<BrowserWindow>

üìÅHotelX  
&nbsp;&nbsp;&nbsp;&nbsp; üìÅHotelX_0000  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; üìÅBusinessRules  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **üìÑ[BuyerContext_sequential_preference.csv](https://storage.travelgate.com/docs/BuyerContext_sequential_preference.csv)**

</BrowserWindow>
```

:::note

If you need assistance with requesting your credentials to access the SFTP server, determining the endpoint and directory format, or learning how to upload, update, and delete SFTP files, please refer to the [overview](/docs/apis/for-buyers/hotel-x-pull-buyers-api/plugins/overview) section of Plugins.

:::

### File Format Specification

* **File Name:** BuyerContext_sequential_preference.csv
* **Directory:** HotelX/HotelX\_0000/BusinessRules
* **Delimiter:** Comma (`,`)
* **Header Row:**
   * **RuleId (mandatory):** Rule identifier
   * **ClientTokens:** Identifier provided by the client that is used to filter which business rules can be applied for the sent request.
      * Separator for multiples codes in the same row: Semicolon `;`
   * **SupplierCodes (mandatory):** Supplier codes you want the preference to be applied to.
      * Separator for multiples codes in the same row: Semicolon `;`
   * **NotSupplierCodes (mandatory):** Supplier codes you don't want the preference to be applied to.
      * Separator for multiples codes in the same row: Semicolon `;`
   * **BookingDateFrom:** Booking date from (yyyy-mm-dd)
   * **BookingDateTo:** Booking date to (yyyy-mm-dd)
   * **StartDateFrom:** Start date from (yyyy-mm-dd)
   * **StartDateTo:** Start date to (yyyy-mm-dd)
   * **HotelCodes:** Hotel codes you want the preference to be applied to.
      * Separator for multiples codes in the same row: Semicolon `;`
   * **NotHotelCodes:** Hotel codes you don't want the preference to be applied to.
      * Separator for multiples codes in the same row: Semicolon `;`
   * **ChainsCodes:** Chain codes you want the preference to be applied to.
      * Separator for multiples codes in the same row: Semicolon `;`
   * **NotChainCodes:** Chain codes you don't want the preference to be applied to.
      * Separator for multiples codes in the same row: Semicolon `;`
   * **DestinationCodes:** Destination codes you want the preference to be applied to.
      * Separator for multiples codes in the same row: Semicolon `;`
   * **NotDestinationCodes:** Destination codes you don't want the preference to be applied to.
      * Separator for multiples codes in the same row: Semicolon `;`
   * **Status:** Option status (OK, RQ) you want the preference to be applied to.
      * Separator for multiples codes in the same row: Semicolon `;`
   * **NotStatus:** Option status (OK, RQ) you don't want the preference to be applied to.
      * Separator for multiples codes in the same row: Semicolon `;`
   * **Percentage (mandatory):** Commission value, decimal separator must be point `.`. Percentage represents the tolerance you allow over the net price to avoid discarding the option. In other words, options that meet the criteria of this rule will not be discarded, even if they are up to X% more expensive than the cheapest option.
   * **FilterCompetitors (mandatory):** true/false value. If set to true, it means that if an option exists that meets the criteria of this rule, only that option will be kept, and all others will be discarded. This ensures you only retain the option that follows the rule's criteria.


<details>
    <summary>üìπLearn how to change the format of the csv file in order to edit and save it</summary>
    <div>
        <div><iframe width="560" height="315" src="https://www.youtube.com/embed/XkOk3SkZ0Sg?si=TYhN1QfMwYE1fusw&amp;controls=0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></div>
    </div>
</details>



## 2. Execute Preference Plugin in your Query

Once you've uploaded your preference file, to use the plugin add the following field to the `settings` node of your request. Note that preference plugin can just be executed in search query. In order to successfully execute the preference plugin, you will need to create the request with the following variables.

* **`step`**: "RESPONSE"
* **`type`**: "PRE_STEP"
* **`name`**: "preference"
* **`parameters`**:
	* **`primaryKey`**: Criteria used to aggregate, separated by commas. For example: "hotel, supplier, board". Possible values are: 
		* hotel
		* supplier
		* board
		* binding
		* cancelPolicy
		* currency
		* market
		* payment
		* promotion
		* rateRules
		* refundable
		* room 
		* supplement
		* surcharges
		* ratePlan
		* status

   * **`optionsPerKey`**: Limits the number of options per aggregation group, this being defined by the previous primakyKey parameter. Value: Integer.
   * **`internalCurrencyConversion`**: Enables internal currency conversion for aggregation. Value: `true` or `false`. By default, aggregation considers the **currency**, meaning that only options sharing the same currency are grouped together. If you receive responses from multiple suppliers using different currencies but want to internally compare them, you can enable this option.  When set to **`true`**, Travelgate will apply an internal currency conversion to allow aggregation and comparison of options within the same `primaryKey` group, even if they have different currencies. This conversion is only used for aggregation purposes‚Äî**the final response will always return prices in their original currency**.  

:::caution Remember

`primaryKey` is a mandatory parameter in order to activate the plugin. `optionsPerKey` and `internalCurrencyConversion` are optional and complementary of the first.

:::
   

```js
"settings": {
	"plugins": [
		{
			"step": "RESPONSE",
			"pluginsType": {
				"type": "PRE_STEP",
				"name": "preference",
            "parameters" : [
                        {
                            "key" : "primaryKey",
                            "value" : "hotel,board,room"
                        }
                    ]
			}
		}
	]
}
```



