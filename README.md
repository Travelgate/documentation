# Travelgate Documenation

This website is built using [Docusaurus 3](https://docusaurus.io/)

## Requirements
* Node.js version 18 or above

## Installation

```
$ npm install
```

### Generate GraphQL API reference

To run this command, you need to have a Travelgate api key called `TRAVELGATE_API_KEY`  in
your environment variables. You can get the key from the team. The way you set the environment
variable depends on your operating system.

```
npx docusaurus graphql-to-doc
```

or with a temporary environment variable:

```
TRAVELGATE_API_KEY=your_api_key npx docusaurus graphql-to-doc
```

The GraphQL API reference is generated from the TravelgateX GraphQL schema but
the `sidebar-schema.js` needs to be updated. Copy + paste the following code in your
`api/sidebar-schema.js` file: (***create the file manually if necessary**)

```javascript
/** @type {import('@docusaurus/plugin-content-docs').SidebarsConfig} */

module.exports = {
    schemaSidebar: [
        {
            type: "autogenerated",
            dirName: ".",
        },
    ],
};
```

#### Generate GraphQL API Reference (Windows GUI)

To generate the GraphQL API reference using the Windows GUI, follow these steps:

1. Open **Control Panel** and navigate to **System and Security**.
2. Click on **System**, then select **Advanced system settings**.
3. In the **Advanced** tab, click on **Environment Variables**.
4. Under **User variables**, click **New** and enter the following details:
   - **Variable name**: `TRAVELGATE_API_KEY`
   - **Variable value**: (Provided by the Travelgate team)
5. Click **OK** to save the changes and close all dialog boxes.
6. Open **Windows PowerShell**, navigate to your documentation project directory, and run the following command:

```
npx docusaurus graphql-to-doc
```

7. Once the reference is generated, update the sidebar-schema.js file in your api directory (create the file if it doesn’t exist) with the following content:

```javascript
/** @type {import('@docusaurus/plugin-content-docs').SidebarsConfig} */

module.exports = {
    schemaSidebar: [
        {
            type: "autogenerated",
            dirName: ".",
        },
    ],
};
```

This process will generate the GraphQL API reference from the TravelgateX GraphQL schema.


## Local Development

## Local Development

```
$ npm run start
```

This command starts a local development server and opens up a browser window. Most changes are reflected live without having to restart the server.

### Build (optional)

```
$ npm run build
```

This command generates static content into the `build` directory and can be served using any static contents hosting service.

### Test `.mdx` structure before commit/push

```bash
npx docusaurus-mdx-checker
```

## Deployment

This repository is being automatically deployed to GitHub Pages using GitHub Actions.
The deployment script is located in `.github/workflows/main.yml`.

# Update / Upgrade

To update the Docusaurus version, its dependencies and the rest of the dependencies, run the following commands:

```bash
rm -rf node_modules
npm update --save
```

You can avoid removing the `node_modules` but it's recommended to do so to avoid any conflicts.

Before pushing the changes, make sure to test the website locally and check if everything is working as expected:

```bash
npm run build && npm run start
```

Be patient, the build process can take a while.

**IMPORTANT:** If you are upgrading `@graphql-markdown/docusaurus` version, make sure to run `graphql-to-doc` command
to check the generated API reference locally before pushing the changes. If your locally generated API reference
structure is different from the one in live, you need to inform the team about the changes in #documenters channel.

This step is important, because the generated links are also used to train Aina bot. If the links are
not working, Aina will not be able to provide the correct information.




# 📘 Automated GraphQL Documentation Generation

This guide explains how to **automatically generate documentation** for the GraphQL API using scripts that extract information from the schema and insert it into `.mdx` documentation files.

---

## 📌 1. Prerequisites

Before running the scripts, ensure that your environment meets the following requirements:

- **Access to the TravelgateX GraphQL API endpoint**.
- A **valid Bearer Token** for authentication.
- The **GraphQL schema** must be available in the correct directory.

---

## 📂 2. Project Structure

The documentation system follows this file structure:

📂 src ├── 📂 graphql │ ├── 📂 scripts │ │ ├── fetchSchema.js # Script to fetch the GraphQL schema and save it as JSON │ │ ├── updateDocs.js # Script to generate documentation from the schema │ ├── 📂 schema-json │ │ ├── inventory-schema.json # JSON file containing the GraphQL schema │ ├── 📂 node-map │ │ ├── fileNodeMap.js # Mapping of GraphQL nodes to documentation files 📂 docs ├── 📂 apis │ ├── 📂 for-sellers │ ├── 📂 for-buyers │ │ ├── some-api-document.mdx # Documentation files in MDX format


---

## 📖 3. **MDX File Structure Guidelines**

To ensure the **documentation is inserted correctly** within `.mdx` files, they must contain the **`## Examples`** section.

### ❓ **Why is `## Examples` Important?**
The `updateDocs.js` script **uses this section as a reference** to insert the generated documentation just **before** it.  
If `## Examples` is missing, **the documentation will be appended to the end of the file**, which may disrupt the expected structure.

### ✅ **Example of a Well-Structured `.mdx` File**

# Hotel Master API

General description of the hotel API.

## Query Inputs

(Automatically generated documentation will be inserted here)

## Mutation Inputs

(Automatically generated documentation will be inserted here)

## Returned Fields

(Automatically generated documentation will be inserted here)

## Examples

### Create a Hotel

```graphql
mutation {
  createHotel(input: { name: "Hotel Example", email: "hotel@example.com" }) {
    id
    name
  }
}
```

### ❌ **Example of a Poorly Structured `.mdx` File**
If the `.mdx` file **does not** contain `## Examples`, the documentation **will be inserted at the end**:


# Hotel Master API

General description of the hotel API.

(Automatically generated documentation will be inserted here, but at the end)

## 🛠 Solution
To maintain a **clear structure**, always include the `## Examples` section before running `updateDocs.js`.

## 🚀 4. Fetch the GraphQL Schema (`fetchSchema.js`)

### 🔹 Description
This script retrieves the GraphQL schema from the TravelgateX endpoint and **stores it as a JSON file**.

### 🛠 Configuration
1. In `src/graphql/scripts/fetchSchema.js`, modify the `REQUIRED_TYPES` constant to include the **GraphQL types** you want to document.
2. Set the correct **`GRAPHQL_ENDPOINT`** and **`BEARER_TOKEN`**.

### ▶️ Run the Script
To fetch the schema, execute:

```bash
node src/graphql/scripts/fetchSchema.js
```
## 📌 Result  
A JSON file will be generated at:  
📂 `src/graphql/schema-json/inventory-schema.json`  

## 📝 5. Configure the Mapping (`fileNodeMap.js`)  

The `fileNodeMap.js` file **maps GraphQL nodes to `.mdx` files**.  
This mapping ensures that `updateDocs.js` inserts documentation into the correct location.  

### 📍 Example of Mapping:  

```js
const FILE_NODE_MAP = {
    "for-sellers/inventory-sellers/inventory-push-graphql-api/masters/hotels-master/create-hotel-master.mdx": ["InventoryHotelMasterCreateInput", "HotelsRs"],
    "for-sellers/inventory-sellers/inventory-push-graphql-api/set-up/hotels-set-up/update-hotel-set-up.mdx": ["InventoryHotelsSetupUpdateInput", "HotelsSetupRs"],
};
module.exports = FILE_NODE_MAP;
```

Ensure that **each entry in this mapping** corresponds to an existing `.mdx` file in `docs/apis`.

## 🔄 6. Generate the Documentation (`updateDocs.js`)

### 🔹 Description  
This script:  
- Reads the `inventory-schema.json` file.  
- Finds the GraphQL types in `fileNodeMap.js`.  
- **Generates or updates** the documentation inside `.mdx` files.  

### ▶️ Run the Script  
To generate the documentation, execute:  

```bash
node src/graphql/scripts/updateDocs.js
```

## 📌 Result  
- Documentation is inserted into `.mdx` files.  
- If documentation already exists, it is **updated** instead of duplicated.  
- The documentation is **generated before** the `## Examples` section in each `.mdx` file.  

## 📋 7. Generated Documentation Format  

### ✅ Example of a Normal Field  

```md
<details style={{ pointerEvents: "none" }}>
  <summary>
  **hotelCode**&nbsp;<span class="required"> *</span>&nbsp; (*String*)  
  Hotel code.
  </summary>
</details>
```

### ✅ Example of an Enum Field 

```md
<details style={{ pointerEvents: "none" }}>
  <summary>
  **level**&nbsp;<span class="required"> *</span>&nbsp; (*Enum of AdviseMessageLevel*)  
  Indicates the level of importance of the message. Possible values:  
  `ERROR`  
  `WARN`  
  `INFO`  
  </summary>
</details>
```

## 🛠 8. Troubleshooting  

### ❌ Error: Documentation is not inserted into `.mdx` files  
🔍 **Possible Cause:** The `.mdx` files are not correctly mapped in `fileNodeMap.js`.  
✔ **Solution:** Verify that the file names in `fileNodeMap.js` exactly match the `.mdx` files in `docs/apis`.  

### ❌ Error: JSON Schema Not Found  
🔍 **Possible Cause:** The `fetchSchema.js` script was not executed properly.  
✔ **Solution:** Run:  

```bash
node src/graphql/scripts/fetchSchema.js
```

### ❌ Error: Enum Values Are Not Displaying Correctly  
🔍 **Possible Cause:** The `updateDocs.js` script is not formatting enum values correctly.  
✔ **Solution:** Ensure that enum values are formatted using **backticks (`)**:  

```md
Possible values:  
`ERROR`  
`WARN`  
`INFO`
```

## 🎯 9. Conclusion  

By following these steps, you can **automate the generation and updating of GraphQL API documentation** in `.mdx` files.  
This process ensures that your documentation stays **consistent and up-to-date** with the latest API schema.  

🚀 **Start automating your GraphQL API documentation today!** 🚀  


